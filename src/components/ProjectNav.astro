---
//Assets
import logo from "@images/logo-white.png";
import logoDark from "@images/logo.png"

export interface Props {
    slides: {id: string}[]
}

const { slides } = Astro.props
---
<nav class="navbar">
    <a href="/" class="navbar__logo">
        <img src={logo} alt="logo"/>
    </a>
    <a href="/" class="navbar__logo is-dark">
        <img src={logoDark} alt="logo"/>
    </a>
    <ul class="slides">
        {
            slides.map((slide) => (
                <li class="slides__item" data-id={slide.id}>
                    <span class="slides__item-indicator"/>
                    <a class="slides__item__link" href={"#" + slide.id}/>
                </li>
            ))
        }
    </ul>
    <a href="/" class="navbar__logo">
        <img src={logo} alt="logo"/>
    </a>
    <a href="/" class="navbar__logo is-dark">
        <img src={logoDark} alt="logo"/>
    </a>
</nav>

<style>
    .navbar{
        display: flex;
        padding: 6px 10px 0;
        justify-content: space-between;
        margin-bottom: 24px;
        position: fixed;
        width: 100vw;
        left: 0;
        top: 0;
        z-index: 2;
    }

    .navbar__logo{
        width: 50px;
    }

    .navbar__logo img{
        width: 100%;
    }

    .navbar__logo.is-dark {
        display: none;
    }
    
    .navbar.has-contrast .navbar__logo:not(.is-dark){
        display: none;
    }

    .navbar.has-contrast .navbar__logo.is-dark{
        display: block;
    }


    @media (max-width: 600px){
        .navbar{
            margin-bottom: 16px;
            padding: 0 16px;
        }

        .navbar__logo,
        .navbar.has-contrast .navbar__logo.is-dark{
            display: none;
        }
    }

    .slides{
        display: flex;
        align-items: center;
        column-gap: 8px;
        padding-top: 8px;
        list-style-type: none;
        margin: 0;
        padding-left: 0;
        width: 375px;
    }

    @media (max-width: 600px){
        .slides{
            width: 100%;
            padding-top: 32px
        }
    }

    .slides__item{
        height: 4px;
        background-color: rgba(255, 255, 255, 0.2);
        flex: 1 0 0;
        position: relative;
    }

    .slides__item.is-active{
        background-color: white;
    }

    .slides__item-indicator{
        position: absolute;
        top: 0;
        left: 0;
        background-color: white;
        height: 100%;
        width: 100%;
        transform: scaleX(0);
        transform-origin: top left;
        content: '';
    }

    .slides__item.is-animating .slides__item-indicator{
        animation: loading 2s forwards;
    }

    @keyframes loading{
        to{
            transform: scaleX(100%);
        }
    }

    .slides__item__link{
        width: 100%;
        height: 100%;
        display: block;
    }

    .navbar.has-contrast .slides__item{
        display: none;
    }
</style>
<script>
    import { getSlidesObject, getActiveSlide } from "../utils/projectSlideUtils.js"

    const slideIndicatorElements = [...document.querySelectorAll(".slides__item")];
    const indicatorsObject = getSlidesObject(".slides__item")

    const renderSlideIndicators = () => {
        const activeSlide = getActiveSlide({
            query: ".slides__item",
            elementsObject: indicatorsObject
        })

        if(!activeSlide) return

        let activeSlideIndex = indicatorsObject[activeSlide].index;

        //Loop through elements and add active class where appropriate
        slideIndicatorElements.forEach((element, index) => {
            if(index < activeSlideIndex){
                element.classList.add("is-active")
                element.classList.remove("is-animating")
            }else if(index === activeSlideIndex){
                element.classList.remove("is-active")
                element.classList.add("is-animating")
            }else{
                element.classList.remove("is-animating")
                element.classList.remove("is-active")
            }
        })
    }

    slideIndicatorElements.forEach((element, index) => {
        const indicator = element.querySelector('.slides__item-indicator')
        indicator.addEventListener('animationend', () => {
            const nextElement = slideIndicatorElements[index + 1];

            if(nextElement){
                window.location.hash = nextElement.dataset.id
            }
        })
    })

    window.addEventListener("DOMContentLoaded", renderSlideIndicators)
    window.addEventListener("hashchange", renderSlideIndicators)
</script>